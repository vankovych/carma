<!DOCTYPE html>
<html>
    <head>
        <title>ELEKS Career Map</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/vendor/normalize.css">
        <link rel="stylesheet" href="css/style.css">

        <script src="js/libs/d3/d3.js"></script>
        <!--<script src="js/libs/jquery/jquery-2.1.4.min.js"></script>-->

        <script src="js/app/main.js"></script>
    </head>
    <body>
        <div id="container">
            <div class="menu">
                <h3><a href="#">eleks Career map</a></h3>
                <ul>
                    <li><a href="#" class="active">Career opportunities</a></li>
                    <li><a href="#">Discovery positions</a></li>
                </ul>                
            </div>
            <div id="map"></div>
        </div>
        <script>
            'use strict';

            var R = 300,
                    CX = 100,
                    CY = 100,
                    P = Math.PI * 2,
                    ArcLen = P / 20,
                    ArcMargin = P / 400;

            d3.json('data.json', function (error, json) {
                if (error) {
                    return console.warn(error);
                }

                var divisions = json.divisions;

                divisions.forEach(function (d, i) {
                    d.i = i++;
                    d.startAngle = ArcLen * i;
                    d.endAngle = ArcLen * (i + 1) - ArcMargin;
                });

                var svg = d3.select('div#map').append('svg');
                var group = svg.append('g')
                        .attr('transform', 'translate(250, 250)');

                group.append('circle')
                        .attr('cx', CX)
                        .attr('cy', CY)
                        .attr('class', 'circle-main-in')
                        .attr('r', R - 7);

                // render placeholder
                group.selectAll('path.placeholder')
                        .data(divisions).enter()
                        .append('path')
                        .attr('d', arc)
                        .attr('cx', 100)
                        .attr('transform', 'translate(100,100)')
                        .attr('class', 'placeholder');

                // render divisions
                group.selectAll('path.division')
                        .data(divisions).enter()
                        .append('path')
                        .attr('d', arc)
                        .attr('cx', 100)
                        .attr('transform', 'translate(100,100)')
                        .attr('class', 'division')
                        .attr('fill', function (d) {
                            return d.color;
                        })
                        .on('click', moveArc);

                group.selectAll('text')
                        .data(divisions).enter()
                        .append('text')
                        .attr('class', 'division-title')
                        .attr("x", function (d) {
                            return 200;//d.x < 180 ? 8 : -8;
                        })
                        .attr('y', function (d) {
                            return d.i * 30;//d.x < 180 ? 8 : -8;
                        })
                        .attr("text-anchor", function (d) {
                            return 'start';//d.x < 180 ? "start" : "end";
                        })
                        .attr('transform', function (d) {
                            return null;//d.x < 180 ? null : "rotate(180)";
                        })
                        .attr('rotate', function (d) {
                            return null;//d.x < 180 ? null : "rotate(180)";
                        })
                        .text(function (d) {
                            return d.title;
                        });
            });

            // Arc function
            var arc = d3.svg.arc()
                    .startAngle(function (d) {
                        return d.startAngle;
                    })
                    .endAngle(function (d) {
                        return d.endAngle;
                    })
                    .innerRadius(R - 10)
                    .outerRadius(R + 7);

            function moveArc() {
                d3.select(this)
                        .transition()
                        .duration(750)
                        .call(arcTween, 0.73 * P, 0.78 * P - ArcMargin);
            }

            function arcTween(transition, newAngleS, newAngleE) {
                transition.attrTween("d", function (d) {

                    var interpolateS = d3.interpolate(d.startAngle, newAngleS);
                    var interpolateE = d3.interpolate(d.endAngle, newAngleE);

                    return function (t) {
                        d.startAngle = interpolateS(t);
                        d.endAngle = interpolateE(t);

                        return arc(d);
                    };
                });
            }


        </script>
    </body>
</html>
